/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository
*/

var M=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var D=(h,e)=>{for(var t in e)M(h,t,{get:e[t],enumerable:!0})},V=(h,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of L(e))!$.call(h,n)&&n!==t&&M(h,n,{get:()=>e[n],enumerable:!(s=A(e,n))||s.enumerable});return h};var I=h=>V(M({},"__esModule",{value:!0}),h);var B={};D(B,{default:()=>E});module.exports=I(B);var b=require("obsidian");var C={enableLogging:!1,attachmentKey:"attachments",typeDepth:"leaf",excludedFolders:["System",".obsidian",".trash"],typeFolders:["01 Action Items","02 Pages"],showInReadingView:!0,showInLivePreview:!0,badgeProperties:["status","priority"]},S=`
  /* TPS Projects Menu Container */
  .tps-projects-menu {
    position: static;
    background: transparent;
    border: none;
    box-shadow: none;
    width: 100%;
    max-width: 100%;
    padding: 0;
    margin-bottom: 1em;
  }

  .tps-projects-menu--live {
    position: fixed;
    bottom: calc(70px + env(safe-area-inset-bottom, 0px));
    left: 0;
    right: 0;
    margin-left: auto;
    margin-right: auto;
    z-index: 99;
    padding: 8px 12px;
    width: min(92vw, 420px);
    max-width: calc(100vw - 24px);
    background-color: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  /* Header */
  .tps-projects-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 4px 0;
    cursor: pointer;
    user-select: none;
  }

  .tps-projects-header-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .tps-projects-header-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.05em;
  }

  .tps-projects-header-count {
    font-size: 10px;
    color: var(--text-faint);
    background: var(--background-modifier-hover);
    padding: 1px 6px;
    border-radius: 10px;
  }

  .tps-projects-header-actions {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* Collapse Button */
  .tps-projects-collapse-btn {
    min-width: 24px;
    min-height: 24px;
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 1px solid var(--background-modifier-border);
    background: var(--background-primary);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    padding: 0;
    transition: all 0.15s ease;
  }

  .tps-projects-collapse-btn:hover {
    background: var(--background-modifier-hover);
    color: var(--text-normal);
    border-color: var(--interactive-accent);
  }

  .tps-projects-collapse-btn svg {
    width: 12px;
    height: 12px;
    transition: transform 0.2s ease;
  }

  .tps-projects-menu--collapsed .tps-projects-collapse-btn svg {
    transform: rotate(-90deg);
  }

  /* Add Button */
  .tps-projects-add-btn {
    padding: 2px 8px;
    font-size: 11px;
    border-radius: 4px;
    border: 1px solid var(--background-modifier-border);
    background: var(--background-primary);
    color: var(--text-muted);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    transition: all 0.15s ease;
  }

  .tps-projects-add-btn:hover {
    background: var(--background-modifier-hover);
    color: var(--text-normal);
    border-color: var(--interactive-accent);
  }

  /* Attached Notes List */
  .tps-projects-list {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 8px 0 0;
    border-left: 2px solid var(--background-modifier-border);
    margin-left: 4px;
    padding-left: 12px;
  }

  .tps-projects-menu--collapsed .tps-projects-list {
    display: none;
  }

  /* Note Item */
  .tps-projects-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.15s ease;
  }

  .tps-projects-item:hover {
    background: var(--background-modifier-hover);
  }

  .tps-projects-item-left {
    display: flex;
    align-items: center;
    gap: 6px;
    min-width: 0;
    flex: 1;
  }

  .tps-projects-item-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 14px;
    height: 14px;
    color: var(--text-muted);
    flex-shrink: 0;
  }

  .tps-projects-item-icon svg {
    width: 14px;
    height: 14px;
  }

  .tps-projects-item-title {
    font-size: 13px;
    color: var(--text-normal);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .tps-projects-item-type {
    font-size: 10px;
    color: var(--text-faint);
    background: var(--background-modifier-hover);
    padding: 1px 4px;
    border-radius: 3px;
  }

  /* Badge Container */
  .tps-projects-item-badges {
    display: flex;
    align-items: center;
    gap: 4px;
    flex-shrink: 0;
  }

  /* Badge Styles (matching TPS-Global-Context-Menu) */
  .tps-projects-badge {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 2px 6px;
    border-radius: 3px;
    white-space: nowrap;
  }

  .tps-projects-badge-status {
    background: var(--background-modifier-hover);
    color: var(--text-muted);
  }

  .tps-projects-badge-open { background: hsla(200, 50%, 30%, 0.4); color: hsl(200, 60%, 75%); }
  .tps-projects-badge-working { background: hsla(45, 50%, 30%, 0.4); color: hsl(45, 60%, 75%); }
  .tps-projects-badge-blocked { background: hsla(0, 50%, 30%, 0.4); color: hsl(0, 60%, 75%); }
  .tps-projects-badge-complete { background: hsla(120, 50%, 30%, 0.4); color: hsl(120, 60%, 75%); }
  .tps-projects-badge-wont-do { background: hsla(270, 30%, 30%, 0.4); color: hsl(270, 40%, 75%); }

  .tps-projects-badge-priority {
    background: var(--background-modifier-hover);
    color: var(--text-muted);
  }

  .tps-projects-badge-high { background: hsla(0, 60%, 30%, 0.4); color: hsl(0, 70%, 75%); }
  .tps-projects-badge-medium { background: hsla(30, 50%, 30%, 0.4); color: hsl(30, 60%, 75%); }
  .tps-projects-badge-normal { background: hsla(210, 30%, 30%, 0.4); color: hsl(210, 40%, 75%); }
  .tps-projects-badge-low { background: hsla(180, 30%, 30%, 0.4); color: hsl(180, 40%, 75%); }

  /* Empty State */
  .tps-projects-empty {
    font-size: 12px;
    color: var(--text-faint);
    font-style: italic;
    padding: 8px 0;
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .tps-projects-menu--live {
      bottom: calc(100px + env(safe-area-inset-bottom, 0px));
      width: calc(100vw - 32px);
    }

    .tps-projects-item-badges {
      flex-wrap: wrap;
    }
  }

  /* Hidden for keyboard on mobile */
  .tps-projects-hidden-for-keyboard .tps-projects-menu--live {
    visibility: hidden;
    opacity: 0;
    pointer-events: none;
  }

  /* Clickable title */
  .tps-projects-item-title--clickable {
    cursor: pointer;
    border-radius: 3px;
    padding: 2px 4px;
    margin: -2px -4px;
    transition: background-color 0.15s ease, color 0.15s ease;
  }

  .tps-projects-item-title--clickable:hover {
    background: var(--interactive-accent);
    color: var(--text-on-accent);
  }

  /* Clickable badge */
  .tps-projects-badge--clickable {
    cursor: pointer;
    transition: filter 0.15s ease, transform 0.1s ease;
  }

  .tps-projects-badge--clickable:hover {
    filter: brightness(1.2);
    transform: scale(1.05);
  }

  /* Parent Notes Section (above inline title) */
  .tps-projects-parents {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 6px;
    padding: 4px 0;
    margin-bottom: 4px;
    font-size: 11px;
    color: var(--text-muted);
  }

  .tps-projects-parents-label {
    font-size: 10px;
    text-transform: uppercase;
    font-weight: 600;
    color: var(--text-faint);
    letter-spacing: 0.05em;
  }

  .tps-projects-parent-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    background: var(--background-modifier-hover);
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.15s ease;
  }

  .tps-projects-parent-link:hover {
    background: var(--interactive-accent);
    color: var(--text-on-accent);
  }

  /* Create Note Modal */
  .tps-projects-create-modal .setting-item {
    border-top: none;
  }

  .tps-projects-create-modal-subtitle {
    font-size: 12px;
    color: var(--text-faint);
    margin-top: -8px;
    margin-bottom: 16px;
  }

  .tps-projects-body-container {
    margin-top: -8px;
    margin-bottom: 12px;
  }
`;var N=require("obsidian"),x=class{constructor(e){this.typeCache=[];this.cacheValid=!1;this.plugin=e}get app(){return this.plugin.app}getAllTypes(){return this.cacheValid||this.refreshCache(),this.typeCache}getTypeForPath(e){return this.getAllTypes().find(s=>s.path===e)||null}getTypeByName(e){return this.getAllTypes().find(s=>s.name.toLowerCase()===e.toLowerCase())||null}isExcluded(e){return(this.plugin.settings.excludedFolders||[]).some(s=>{let n=s.trim();return n?e===n||e.startsWith(n+"/"):!1})}refreshCache(){this.typeCache=[];let e=this.plugin.settings.typeFolders||[],t=this.plugin.settings.typeDepth||"leaf";for(let s of e){let n=this.app.vault.getAbstractFileByPath(s);n instanceof N.TFolder&&this.scanFolder(n,t)}this.cacheValid=!0,this.log(`Type cache refreshed: ${this.typeCache.length} types found`)}invalidateCache(){this.cacheValid=!1}scanFolder(e,t){if(this.isExcluded(e.path))return;let s=e.children.filter(n=>n instanceof N.TFolder&&!this.isExcluded(n.path));if(t==="all"){this.addType(e);for(let n of s)this.scanFolder(n,t)}else if(s.length===0)this.addType(e);else for(let n of s)this.scanFolder(n,t)}addType(e){let t={id:e.path,name:e.name,path:e.path};this.typeCache.push(t)}getTypeIcon(e){let t=e.name.toLowerCase();return t.includes("project")?"folder-kanban":t.includes("todo")||t.includes("task")?"check-square":t.includes("event")?"calendar":t.includes("reference")?"book-open":t.includes("topic")||t.includes("brainstorm")?"lightbulb":t.includes("keep")||t.includes("mind")?"brain":t.includes("thing")||t.includes("list")?"list":"file-text"}log(...e){this.plugin.settings.enableLogging&&console.log("[TPS Projects]",...e)}};var T=require("obsidian"),w=class{constructor(e){this.plugin=e}get app(){return this.plugin.app}getAttachedNotes(e){var p;let t=this.plugin.settings.attachmentKey||"attachments",s=e.basename,n=e.path,i=[];this.log(`Searching for notes attached to: "${s}" (${n})`);let o=this.app.vault.getMarkdownFiles();for(let r of o){if(r.path===n)continue;let a=this.app.metadataCache.getFileCache(r),l=a==null?void 0:a.frontmatter;if(!l)continue;let c=l[t];if(!c)continue;let u=Array.isArray(c)?c:[c];for(let m of u)if(typeof m=="string"&&(this.log(`Checking file "${r.basename}": ${t}="${m}"`),this.matchesLink(m,s,n))){let f=this.plugin.typeService.getTypeForPath(((p=r.parent)==null?void 0:p.path)||"");this.log(`  -> MATCHED! Adding "${r.basename}" to results`),i.push({file:r,type:f,frontmatter:l||{}});break}}return this.log(`Found ${i.length} attached notes for "${s}"`),i.sort((r,a)=>r.file.basename.localeCompare(a.file.basename)),i}getParentNote(e){let t=this.getAllParentNotes(e);return t.length>0?t[0]:null}getAllParentNotes(e){let t=this.plugin.settings.attachmentKey||"attachments",s=this.app.metadataCache.getFileCache(e),n=s==null?void 0:s.frontmatter;if(!n)return[];let i=n[t];if(!i)return[];let o=Array.isArray(i)?i:[i],p=[];for(let r of o){if(typeof r!="string")continue;let a=r.match(/\[\[([^\]|#]+)(?:#[^\]|]*)?(?:\|[^\]]+)?\]\]/),l=a?a[1].trim():r,c=this.app.metadataCache.getFirstLinkpathDest(l,e.path);c instanceof T.TFile&&p.push(c)}return p}async attachNote(e,t){let s=this.plugin.settings.attachmentKey||"attachments",n=`[[${t.basename}]]`;await this.app.fileManager.processFrontMatter(e,i=>{i[s]=n}),this.log(`Attached "${e.basename}" to "${t.basename}"`)}async detachNote(e){let t=this.plugin.settings.attachmentKey||"attachments";await this.app.fileManager.processFrontMatter(e,s=>{delete s[t]}),this.log(`Detached "${e.basename}"`)}async createAttachedNote(e,t,s,n={}){let i=this.plugin.settings.attachmentKey||"attachments",{body:o="",status:p="open",priority:r="normal"}=n,a=`${s}.md`,l=(0,T.normalizePath)(`${t.path}/${a}`);if(this.app.vault.getAbstractFileByPath(l))throw new Error(`File already exists: ${l}`);let u=this.app.vault.getAbstractFileByPath(t.path),m=this.app.plugins.plugins["templater-obsidian"],f;if(m&&m.templater){this.log("Using Templater for file creation");try{if(f=await this.app.vault.create(l,""),await new Promise(d=>setTimeout(d,100)),await this.app.fileManager.processFrontMatter(f,d=>{d.title=s,d[i]=`[[${e.basename}]]`,d.status||(d.status=p),d.priority||(d.priority=r)}),o){let d=await this.app.vault.read(f);await this.app.vault.modify(f,d+`
`+o)}}catch(d){this.log("Templater creation failed, using standard creation",d);let F=`---
title: ${s}
${i}: "[[${e.basename}]]"
status: ${p}
priority: ${r}
---

${o}`;f=await this.app.vault.create(l,F)}}else{let d=`---
title: ${s}
${i}: "[[${e.basename}]]"
status: ${p}
priority: ${r}
---

${o}`;f=await this.app.vault.create(l,d)}return this.log(`Created attached note: ${l}`),f}matchesLink(e,t,s){if(typeof e!="string")return!1;let n=e.match(/^\[\[([^\]|#]+)(?:#[^\]|]*)?(?:\|[^\]]+)?\]\]$/);if(!n)return!1;let i=n[1].trim();if(i===t)return this.log(`Matched: "${i}" === "${t}"`),!0;let o=s.replace(/\.md$/,"");return i===o?(this.log(`Matched path: "${i}" === "${o}"`),!0):!1}log(...e){this.plugin.settings.enableLogging&&console.log("[TPS Projects]",...e)}};var v=require("obsidian");var y=require("obsidian"),j=class extends y.Modal{constructor(t,s,n,i){super(t);this.title="";this.body="";this.status="open";this.priority="normal";this.statusOptions=["open","working","blocked","wont-do","complete"];this.priorityOptions=["high","medium","normal","low"];this.noteType=s,this.parentFile=n,this.onSubmit=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tps-projects-create-modal"),t.createEl("h3",{text:`Create new ${this.noteType.name} note`}),t.createEl("p",{text:`Attached to: ${this.parentFile.basename}`,cls:"tps-projects-create-modal-subtitle"}),new y.Setting(t).setName("Title").setDesc("Name of the new note").addText(r=>{r.setPlaceholder("Enter note title..."),r.inputEl.style.width="100%",r.onChange(a=>{this.title=a}),setTimeout(()=>r.inputEl.focus(),50),r.inputEl.addEventListener("keydown",a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),this.submit())})}),new y.Setting(t).setName("Body (optional)").setDesc("Initial content for the note");let s=t.createDiv({cls:"tps-projects-body-container"}),n=new y.TextAreaComponent(s);n.setPlaceholder("Enter initial content..."),n.inputEl.style.width="100%",n.inputEl.style.minHeight="100px",n.inputEl.style.resize="vertical",n.onChange(r=>{this.body=r}),new y.Setting(t).setName("Status").addDropdown(r=>{this.statusOptions.forEach(a=>{r.addOption(a,a.charAt(0).toUpperCase()+a.slice(1))}),r.setValue(this.status),r.onChange(a=>{this.status=a})}),new y.Setting(t).setName("Priority").addDropdown(r=>{this.priorityOptions.forEach(a=>{r.addOption(a,a.charAt(0).toUpperCase()+a.slice(1))}),r.setValue(this.priority),r.onChange(a=>{this.priority=a})});let i=t.createDiv({cls:"tps-projects-button-container"});i.style.display="flex",i.style.justifyContent="flex-end",i.style.gap="8px",i.style.marginTop="16px",i.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.cancel()),i.createEl("button",{text:"Create",cls:"mod-cta"}).addEventListener("click",()=>this.submit())}submit(){this.title.trim()&&(this.onSubmit({title:this.title.trim(),body:this.body,status:this.status,priority:this.priority}),this.close())}cancel(){this.onSubmit(null),this.close()}onClose(){let{contentEl:t}=this;t.empty()}};var P=class{constructor(e){this.menus=new Map;this.plugin=e}ensureMenus(){var t,s;if(!((s=(t=this.plugin)==null?void 0:t.app)!=null&&s.workspace))return;let e=new Set;this.plugin.app.workspace.getLeavesOfType("markdown").forEach(n=>{let i=n.view;!i||!i.file||(e.add(i),this.ensureReadingMenu(i),this.ensureLiveMenu(i))});for(let n of Array.from(this.menus.keys()))e.has(n)||this.cleanup(n)}ensureReadingMenu(e){var i,o;if(!this.plugin.settings.showInReadingView){this.removeMenu(e,"reading");return}if(e.getMode()!=="preview"){this.removeMenu(e,"reading");return}let t=(i=e.contentEl)==null?void 0:i.querySelector(".markdown-preview-sizer");if(!t){this.removeMenu(e,"reading");return}let s=this.menus.get(e)||{};if(s.reading&&s.filePath!==((o=e.file)==null?void 0:o.path))this.removeMenu(e,"reading");else if(s.reading&&t.contains(s.reading)){this.refreshMenuContent(s.reading,e.file);return}this.removeMenu(e,"reading");let n=this.createProjectMenu(e,"reading");if(n){let p=t.querySelector(".tps-global-context-menu--reading"),r=t.querySelector(".inline-title");p?p.after(n):r?r.after(n):t.prepend(n),s.reading=n,s.filePath=e.file.path,this.menus.set(e,s)}}ensureLiveMenu(e){var i,o;if(!this.plugin.settings.showInLivePreview){this.removeMenu(e,"live");return}if(e.getMode()!=="source"){this.removeMenu(e,"live");return}let t=(i=e.contentEl)==null?void 0:i.querySelector(".markdown-source-view");if(!t||!t.classList.contains("is-live-preview")){this.removeMenu(e,"live");return}let s=this.menus.get(e)||{};if(s.live&&s.filePath!==((o=e.file)==null?void 0:o.path))this.removeMenu(e,"live");else if(s.live&&t.contains(s.live)){this.refreshMenuContent(s.live,e.file);return}this.removeMenu(e,"live");let n=this.createProjectMenu(e,"live");n&&(t.appendChild(n),s.live=n,s.filePath=e.file.path,this.menus.set(e,s))}createProjectMenu(e,t){let s=e.file;if(!s)return null;let n=this.plugin.relationshipService.getAttachedNotes(s),i=this.plugin.relationshipService.getAllParentNotes(s),o=document.createElement("div");if(o.className=`tps-projects-menu tps-projects-menu--${t}`,o.setAttribute("data-file-path",s.path),i.length>0){let a=this.createParentsSection(i);o.appendChild(a)}let p=this.createHeader(s,n.length,o);o.appendChild(p);let r=document.createElement("div");if(r.className="tps-projects-list",n.length===0){let a=document.createElement("div");a.className="tps-projects-empty",a.textContent="No attached notes yet",r.appendChild(a)}else for(let a of n)r.appendChild(this.createNoteItem(a));return o.appendChild(r),o}createParentsSection(e){var n;let t=document.createElement("div");t.className="tps-projects-parents";let s=document.createElement("span");s.className="tps-projects-parents-label",s.textContent="Parent:",t.appendChild(s);for(let i of e){let o=document.createElement("span");o.className="tps-projects-parent-link";let p=this.plugin.app.metadataCache.getFileCache(i),r=((n=p==null?void 0:p.frontmatter)==null?void 0:n.title)||i.basename;/^\d{4}-\d{2}-\d{2}$/.test(r)||(r=r.replace(/ \d{4}-\d{2}-\d{2}$/,"")),o.textContent=r,o.addEventListener("click",a=>{a.stopPropagation(),this.plugin.app.workspace.getLeaf("tab").openFile(i)}),t.appendChild(o)}return t}createHeader(e,t,s){let n=document.createElement("div");n.className="tps-projects-header";let i=document.createElement("div");i.className="tps-projects-header-left";let o=document.createElement("button");o.className="tps-projects-collapse-btn",o.setAttribute("aria-label","Toggle attachments"),(0,v.setIcon)(o,"chevron-down"),o.addEventListener("click",c=>{c.stopPropagation(),s.classList.toggle("tps-projects-menu--collapsed")}),i.appendChild(o);let p=document.createElement("span");p.className="tps-projects-header-title",p.textContent="Attachments",i.appendChild(p);let r=document.createElement("span");r.className="tps-projects-header-count",r.textContent=String(t),i.appendChild(r),n.appendChild(i);let a=document.createElement("div");a.className="tps-projects-header-actions";let l=document.createElement("button");return l.className="tps-projects-add-btn",l.innerHTML="<span>+ Add</span>",l.addEventListener("click",c=>{c.stopPropagation(),this.showAddMenu(c,e)}),a.appendChild(l),n.appendChild(a),n.addEventListener("click",()=>{s.classList.toggle("tps-projects-menu--collapsed")}),n}createNoteItem(e){let t=document.createElement("div");t.className="tps-projects-item",t.setAttribute("data-path",e.file.path);let s=document.createElement("div");s.className="tps-projects-item-left";let n=document.createElement("span");n.className="tps-projects-item-icon";let i=e.type?this.plugin.typeService.getTypeIcon(e.type):"file-text";(0,v.setIcon)(n,i),s.appendChild(n);let o=document.createElement("span");o.className="tps-projects-item-title tps-projects-item-title--clickable";let p=e.frontmatter.title||e.file.basename;if(/^\d{4}-\d{2}-\d{2}$/.test(p)||(p=p.replace(/ \d{4}-\d{2}-\d{2}$/,"")),o.textContent=p,o.addEventListener("click",l=>{l.stopPropagation(),this.plugin.app.workspace.getLeaf("tab").openFile(e.file)}),s.appendChild(o),e.type){let l=document.createElement("span");l.className="tps-projects-item-type",l.textContent=e.type.name,s.appendChild(l)}t.appendChild(s);let r=document.createElement("div");r.className="tps-projects-item-badges";let a=this.plugin.settings.badgeProperties||[];for(let l of a){let c=e.frontmatter[l];if(c){let u=document.createElement("span");u.className=`tps-projects-badge tps-projects-badge-${l} tps-projects-badge-${c} tps-projects-badge--clickable`,u.textContent=c,u.addEventListener("click",m=>{m.stopPropagation(),this.showPropertyMenu(m,e.file,l,c)}),r.appendChild(u)}}return t.appendChild(r),t}showPropertyMenu(e,t,s,n){let i=new v.Menu,o=this.getPropertyOptions(s);for(let p of o)i.addItem(r=>{r.setTitle(p).setChecked(n===p).onClick(async()=>{await this.plugin.app.fileManager.processFrontMatter(t,a=>{a[s]=p}),this.ensureMenus()})});i.showAtMouseEvent(e)}getPropertyOptions(e){return{status:["open","working","blocked","wont-do","complete"],priority:["high","medium","normal","low"]}[e]||[]}showAddMenu(e,t){let s=new v.Menu,n=this.plugin.typeService.getAllTypes();if(n.length===0)s.addItem(i=>{i.setTitle("No types available").setDisabled(!0)});else for(let i of n)s.addItem(o=>{let p=this.plugin.typeService.getTypeIcon(i);o.setTitle(i.name).setIcon(p).onClick(()=>{this.promptCreateNote(t,i)})});s.showAtMouseEvent(e)}promptCreateNote(e,t){new j(this.plugin.app,t,e,async s=>{if(s)try{let n=await this.plugin.relationshipService.createAttachedNote(e,t,s.title,{body:s.body,status:s.status,priority:s.priority});this.plugin.app.workspace.getLeaf("tab").openFile(n),this.ensureMenus()}catch(n){console.error("[TPS Projects] Failed to create note:",n)}}).open()}refreshMenuContent(e,t){let s=this.plugin.relationshipService.getAttachedNotes(t),n=e.querySelector(".tps-projects-header-count");n&&(n.textContent=String(s.length));let i=e.querySelector(".tps-projects-list");if(i)if(i.innerHTML="",s.length===0){let o=document.createElement("div");o.className="tps-projects-empty",o.textContent="No attached notes yet",i.appendChild(o)}else for(let o of s)i.appendChild(this.createNoteItem(o))}removeMenu(e,t){let s=this.menus.get(e);s&&(t==="reading"&&s.reading?(s.reading.remove(),s.reading=null):t==="live"&&s.live&&(s.live.remove(),s.live=null),!s.reading&&!s.live?this.menus.delete(e):this.menus.set(e,s))}cleanup(e){var s,n;let t=this.menus.get(e);t&&((s=t.reading)==null||s.remove(),(n=t.live)==null||n.remove(),this.menus.delete(e))}refreshMenusForFile(e){var t;for(let[s,n]of this.menus.entries())((t=s.file)==null?void 0:t.path)===e.path&&(n.reading&&this.refreshMenuContent(n.reading,e),n.live&&this.refreshMenuContent(n.live,e))}detach(){for(let e of Array.from(this.menus.keys()))this.cleanup(e)}};var g=require("obsidian"),k=class extends g.PluginSettingTab{constructor(t,s){super(t,s);this.plugin=s}display(){let{containerEl:t}=this;t.empty();let s=(a,l=!1)=>{let c=t.createEl("details",{cls:"tps-projects-settings-group"});c.style.border="1px solid var(--background-modifier-border)",c.style.borderRadius="6px",c.style.padding="10px",c.style.marginBottom="10px",l&&c.setAttr("open","");let u=c.createEl("summary",{text:a});return u.style.fontWeight="bold",u.style.cursor="pointer",u.style.marginBottom="10px",c.createDiv({cls:"tps-projects-settings-group-content"})};t.createEl("h2",{text:"TPS Projects"}),t.createEl("p",{text:"Display attached notes in an inline menu bar. Types are dynamically discovered from folder structure."});let n=s("General Settings",!0);new g.Setting(n).setName("Enable console logging").setDesc("Show debug logs in the developer console.").addToggle(a=>a.setValue(this.plugin.settings.enableLogging).onChange(async l=>{this.plugin.settings.enableLogging=l,await this.plugin.saveSettings()})),new g.Setting(n).setName("Show in Reading View").setDesc("Display the attachments menu in Reading mode.").addToggle(a=>a.setValue(this.plugin.settings.showInReadingView).onChange(async l=>{this.plugin.settings.showInReadingView=l,await this.plugin.saveSettings(),this.plugin.projectMenuManager.ensureMenus()})),new g.Setting(n).setName("Show in Live Preview").setDesc("Display the attachments menu in Live Preview mode.").addToggle(a=>a.setValue(this.plugin.settings.showInLivePreview).onChange(async l=>{this.plugin.settings.showInLivePreview=l,await this.plugin.saveSettings(),this.plugin.projectMenuManager.ensureMenus()}));let i=s("Type Configuration",!0);new g.Setting(i).setName("Root folders to scan").setDesc("One folder path per line. These folders will be scanned for types.").addTextArea(a=>{a.setPlaceholder(`01 Action Items
02 Pages`).setValue(this.plugin.settings.typeFolders.join(`
`)).onChange(async l=>{this.plugin.settings.typeFolders=l.split(`
`).map(c=>c.trim()).filter(Boolean),await this.plugin.saveSettings(),this.plugin.typeService.invalidateCache()}),a.inputEl.rows=4,a.inputEl.cols=30}),new g.Setting(i).setName("Type detection depth").setDesc("How to discover types from folders.").addDropdown(a=>a.addOption("leaf","Leaf folders only (most specific)").addOption("all","All folders").setValue(this.plugin.settings.typeDepth).onChange(async l=>{this.plugin.settings.typeDepth=l,await this.plugin.saveSettings(),this.plugin.typeService.invalidateCache()})),new g.Setting(i).setName("Excluded folders").setDesc("One folder path per line. These folders will be excluded from type detection.").addTextArea(a=>{a.setPlaceholder(`System
.obsidian
.trash`).setValue(this.plugin.settings.excludedFolders.join(`
`)).onChange(async l=>{this.plugin.settings.excludedFolders=l.split(`
`).map(c=>c.trim()).filter(Boolean),await this.plugin.saveSettings(),this.plugin.typeService.invalidateCache()}),a.inputEl.rows=4,a.inputEl.cols=30});let o=i.createDiv();o.style.marginTop="10px",o.style.padding="8px",o.style.background="var(--background-primary)",o.style.borderRadius="4px",o.style.fontSize="12px";let p=this.plugin.typeService.getAllTypes();if(o.createEl("strong",{text:`Discovered Types (${p.length}):`}),p.length===0)o.createEl("p",{text:"No types found. Check your root folders configuration."});else{let a=o.createEl("ul");a.style.margin="4px 0",a.style.paddingLeft="20px";for(let l of p.slice(0,15))a.createEl("li",{text:`${l.name} (${l.path})`});p.length>15&&a.createEl("li",{text:`... and ${p.length-15} more`})}let r=s("Attachment Settings",!1);new g.Setting(r).setName("Frontmatter key for attachments").setDesc("The frontmatter property used to link notes together.").addText(a=>a.setPlaceholder("attachments").setValue(this.plugin.settings.attachmentKey).onChange(async l=>{this.plugin.settings.attachmentKey=l||"attachments",await this.plugin.saveSettings()})),new g.Setting(r).setName("Badge properties").setDesc("Comma-separated list of frontmatter properties to display as badges (e.g., status, priority).").addText(a=>a.setPlaceholder("status, priority").setValue(this.plugin.settings.badgeProperties.join(", ")).onChange(async l=>{this.plugin.settings.badgeProperties=l.split(",").map(c=>c.trim()).filter(Boolean),await this.plugin.saveSettings(),this.plugin.projectMenuManager.ensureMenus()}))}};var E=class extends b.Plugin{constructor(){super(...arguments);this.settings=C;this.styleEl=null}async onload(){await this.loadSettings(),this.typeService=new x(this),this.relationshipService=new w(this),this.projectMenuManager=new P(this),this.injectStyles(),this.debouncedEnsureMenus=(0,b.debounce)(()=>{this.projectMenuManager.ensureMenus()},200,!0),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.debouncedEnsureMenus()})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.debouncedEnsureMenus()})),this.registerEvent(this.app.workspace.on("file-open",()=>{this.debouncedEnsureMenus()}));let t=(0,b.debounce)(n=>{this.projectMenuManager.refreshMenusForFile(n)},300,!0);this.registerEvent(this.app.metadataCache.on("changed",t));let s=(0,b.debounce)(()=>{this.typeService.invalidateCache()},500,!0);this.registerEvent(this.app.vault.on("create",n=>{n.path.includes("/")&&s()})),this.registerEvent(this.app.vault.on("delete",s)),this.registerEvent(this.app.vault.on("rename",s)),this.addSettingTab(new k(this.app,this)),this.app.workspace.onLayoutReady(()=>{setTimeout(()=>{this.typeService.refreshCache(),this.projectMenuManager.ensureMenus(),this.log("TPS Projects plugin loaded")},500)})}onunload(){this.projectMenuManager.detach(),this.removeStyles(),this.log("TPS Projects plugin unloaded")}async loadSettings(){this.settings=Object.assign({},C,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.refreshStyles(),this.projectMenuManager.ensureMenus()}injectStyles(){this.styleEl||(this.styleEl=document.createElement("style"),this.styleEl.id="tps-projects-styles",this.styleEl.textContent=S,document.head.appendChild(this.styleEl))}refreshStyles(){this.styleEl&&(this.styleEl.textContent=S)}removeStyles(){this.styleEl&&(this.styleEl.remove(),this.styleEl=null)}log(...t){this.settings.enableLogging&&console.log("[TPS Projects]",...t)}};
